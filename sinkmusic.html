<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SinkMusic - Ïã±ÌÅ¨ Î™®Ïùå</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .search-container {
            margin-bottom: 30px;
            text-align: center;
        }
        .search-dropdown {
            width: 100%;
            max-width: 500px;
            margin: 0 auto 20px auto;
        }
        .select2-container--default .select2-selection--single {
            height: 50px;
            border: 2px solid #ddd;
            border-radius: 25px;
            font-size: 18px;
        }
        .select2-container--default .select2-selection--single .select2-selection__rendered {
            line-height: 46px;
            padding-left: 20px;
            color: #666;
        }
        .select2-container--default .select2-selection--single .select2-selection__arrow {
            height: 46px;
            right: 15px;
        }
        .select2-container--default.select2-container--focus .select2-selection--single {
            border-color: #ff0000;
        }
        .search-results {
            margin-top: 15px;
            color: #666;
            font-size: 14px;
        }
        .highlight {
            background-color: yellow;
            font-weight: bold;
        }
        .no-results {
            text-align: center;
            padding: 40px;
            color: #999;
            font-size: 18px;
        }
        .song-block {
            margin-bottom: 40px;
            transition: opacity 0.3s;
        }
        .song-block.hidden {
            display: none;
        }
        .video-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        .video-wrapper {
            text-align: center;
            position: relative;
        }
        .video-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }
        .controls {
            text-align: center;
            margin-bottom: 10px;
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }
        .btn {
            background: #ff0000;
            color: white;
            border: none;
            padding: 12px 24px;
            margin: 5px 0;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        .btn:hover {
            background: #cc0000;
        }
        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .btn-popup {
            background: #17a2b8;
        }
        .btn-popup:hover {
            background: #138496;
        }
        .sync-slider-container {
            background: #f8f9fa;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border: 1px solid #dee2e6;
            text-align: center;
        }
        .sync-slider-title {
            font-size: 16px;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
        }
        .sync-slider {
            width: 95%;
            max-width: none;
            height: 12px;
            border-radius: 6px;
            background: #ddd;
            outline: none;
            opacity: 0.7;
            transition: opacity 0.2s;
            margin: 15px 0;
        }
        .sync-slider:hover {
            opacity: 1;
        }
        .sync-slider::-webkit-slider-thumb {
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #ff0000;
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
        }
        .sync-slider::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #ff0000;
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
        }
        .sync-value-display {
            font-size: 18px;
            font-weight: bold;
            color: #ff0000;
            margin: 10px 0;
        }
        .sync-description {
            font-size: 14px;
            color: #666;
            margin-top: 10px;
        }
        @media (max-width: 768px) {
            .video-container {
                grid-template-columns: 1fr;
            }
            .controls {
                flex-direction: column;
                gap: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="search-container">
            <select id="songSelect" class="search-dropdown">
                <option value="">üîç Í≥°ÏùÑ ÏÑ†ÌÉùÌïòÍ±∞ÎÇò Í≤ÄÏÉâÌïòÏÑ∏Ïöî...</option>
            </select>
            <div id="searchResults" class="search-results">Í≥°ÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî</div>
        </div>
        <div id="songs-area">
            <!-- ÏÑ†ÌÉùÎêú Í≥°Ïùò UIÍ∞Ä Ïó¨Í∏∞Ïóê Î†åÎçîÎßÅÎê©ÎãàÎã§ -->
        </div>
        <div id="noResults" class="no-results" style="display: none;">
            Í≤ÄÏÉâ Í≤∞Í≥ºÍ∞Ä ÏóÜÏäµÎãàÎã§. Îã§Î•∏ ÌÇ§ÏõåÎìúÎ°ú Í≤ÄÏÉâÌï¥Î≥¥ÏÑ∏Ïöî.
        </div>
    </div>

    <script>
    // 1. Í≥° Ï†ïÎ≥¥ Î∞∞Ïó¥ (Ïó¨Í∏∞Ïóê Í≥°ÏùÑ Ï∂îÍ∞ÄÌïòÎ©¥ Îê®)
    const songs = [
        {
            title: "ÎßåÏ∞¨Í∞Ä(G2B1)",
            guitarId: "bXmApI0Yojc",
            bassId: "xooA8RoU50g",
            delay: 8.1 // Ïã±ÌÅ¨(Ï¥à)
        }
        // Îëê Î≤àÏß∏ Í≥°ÏùÄ ÏïÑÎûòÏ≤òÎüº Ï∂îÍ∞ÄÌïòÎ©¥ Îê©ÎãàÎã§.
         ,{
            title: "Ìè∞ÏÑúÌä∏(G4B1)",
            guitarId: "2sj0Q7XXmeU",
            bassId: "sMJvI1A3zgw",
            delay: 11.1
         }

         ,{
            title: "Î≥ÑÏùò ÌïòÎ™®Îãà(G3B2)",
            guitarId: "L_iW3A0vZ_M",
            bassId: "MQBcx_AXtMs",
            delay: 7.5
         }

         ,{
            title: "Ïò•ÌÉëÎ∞©(G2B2)",
            guitarId: "X0z0uFuCNcs",
            bassId: "_ovwU2gzx9A",
            delay: 8
         }

         ,{
            title: "ÏóêÌîºÏÜåÎìú(G4B2)",
            guitarId: "Fwdwf2Qkz54",
            bassId: "Rnha83fVUTU",
            delay: 7.2
         }

         ,{
            title: "ÎÇôÌôî(G4B3)",
            guitarId: "6DoA3L-Ifwg",
            bassId: "aem73t0x3d4",
            delay: 8
         }
    ];       

    // 2. Í≥°Î≥Ñ ÌîåÎ†àÏù¥Ïñ¥, ÌåùÏóÖ, Ïã±ÌÅ¨Í∞í Í¥ÄÎ¶¨
    let currentPlayer = null; // ÌòÑÏû¨ ÌëúÏãúÎêú Í≥°Ïùò ÌîåÎ†àÏù¥Ïñ¥
    let currentPopupWindows = {}; // ÌòÑÏû¨ Í≥°Ïùò ÌåùÏóÖ
    let currentOffsetSeconds = 0; // ÌòÑÏû¨ Í≥°Ïùò Ïã±ÌÅ¨Í∞í
    let currentSongIdx = -1; // ÌòÑÏû¨ ÏÑ†ÌÉùÎêú Í≥° Ïù∏Îç±Ïä§

    // 3. ÏÑ†ÌÉùÎêú Í≥°Îßå Î†åÎçîÎßÅ
    function renderSelectedSong(idx) {
        const area = document.getElementById('songs-area');
        const song = songs[idx];
        
        // Í∏∞Ï°¥ ÌîåÎ†àÏù¥Ïñ¥ Ï†ïÎ¶¨
        if (currentPlayer) {
            try {
                if (currentPlayer.guitar) currentPlayer.guitar.destroy();
                if (currentPlayer.bass) currentPlayer.bass.destroy();
            } catch (error) {
                console.log('ÌîåÎ†àÏù¥Ïñ¥ Ï†ïÎ¶¨ Ï§ë Ïò§Î•ò:', error);
            }
        }
        
        // Í∏∞Ï°¥ ÌåùÏóÖ Ï†ïÎ¶¨
        Object.keys(currentPopupWindows).forEach(type => {
            const popupData = currentPopupWindows[type];
            if (popupData && popupData.window && !popupData.window.closed) {
                popupData.window.close();
            }
        });
        
        // ÏÉà Í≥° UI ÏÉùÏÑ±
        area.innerHTML = `
            <div class="song-block" id="current-song-block">
                <h2 style="text-align:center; color:#222; margin-bottom:18px;" id="current-song-title">${song.title}</h2>
                <div class="video-container">
                    <div class="video-wrapper">
                        <div class="video-title">üé∏ Í∏∞ÌÉÄ Ïó∞Ï£º</div>
                        <div id="current-guitar-player"></div>
                    </div>
                    <div class="video-wrapper">
                        <div class="video-title">üéµ Î≤†Ïù¥Ïä§ Ïó∞Ï£º</div>
                        <div id="current-bass-player"></div>
                    </div>
                </div>
                <div class="sync-slider-container">
                    <div class="sync-slider-title">üéµ Ïã±ÌÅ¨ Ï°∞Ï†ï</div>
                    <input type="range" id="syncSlider" class="sync-slider" 
                           min="0" max="12" step="0.1" value="${song.delay}">
                    <div class="sync-value-display" id="syncValue">${song.delay}Ï¥à</div>
                    <div class="sync-description"><-Î≤†Ïù¥Ïä§Í∞Ä Îπ®Î¶¨ ÌãÄÏñ¥ÏßêÏùÑ ÏùòÎØ∏</div>
                </div>
                <div class="controls">
                    <button class="btn btn-popup" onclick="openCurrentPopupWindow('guitar')" id="currentGuitarPopupBtn">üé∏ Í∏∞ÌÉÄ ÏÉà Ï∞ΩÏúºÎ°ú Ïó¥Í∏∞</button>
                    <button class="btn" onclick="setCurrentSyncDelay()" id="currentSyncBtn">Ïã±ÌÅ¨ ${song.delay}Ï¥à Ï†ÅÏö©</button>
                    <button class="btn" onclick="playCurrentBoth()" id="currentPlayBtn">‚ñ∂Ô∏è ÎèôÏãú Ïû¨ÏÉù</button>
                    <button class="btn" onclick="stopCurrentBoth()" id="currentStopBtn">‚èπÔ∏è Ï†ïÏßÄ</button>
                </div>
            </div>
        `;
        
        currentSongIdx = idx;
        currentOffsetSeconds = song.delay;
        currentPopupWindows = {};
        
        // Ïä¨ÎùºÏù¥Îçî Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Ï∂îÍ∞Ä
        setTimeout(() => {
            const slider = document.getElementById('syncSlider');
            const valueDisplay = document.getElementById('syncValue');
            
            if (slider && valueDisplay) {
                slider.addEventListener('input', function() {
                    const value = parseFloat(this.value);
                    currentOffsetSeconds = value;
                    valueDisplay.textContent = value + 'Ï¥à';
                });
            }
        }, 100);
        
        // ÏÉà ÌîåÎ†àÏù¥Ïñ¥ ÏÉùÏÑ±
        setTimeout(() => {
            createCurrentPlayers(song);
        }, 100);
    }

    // ÌòÑÏû¨ Í≥°Ïùò ÌîåÎ†àÏù¥Ïñ¥ ÏÉùÏÑ±
    function createCurrentPlayers(song) {
        currentPlayer = {};
        currentPlayer.guitar = new YT.Player('current-guitar-player', {
            height: '315',
            width: '560',
            videoId: song.guitarId,
            playerVars: {
                'controls': 1,
                'modestbranding': 1,
                'rel': 0,
                'fs': 1
            }
        });
        currentPlayer.bass = new YT.Player('current-bass-player', {
            height: '315',
            width: '560',
            videoId: song.bassId,
            playerVars: {
                'controls': 1,
                'modestbranding': 1,
                'rel': 0,
                'fs': 1
            }
        });
        
        // Î≤ÑÌäº ÌôúÏÑ±Ìôî
        setTimeout(() => {
            enableCurrentButtons(true);
        }, 1000);
    }

    // ÎìúÎ°≠Îã§Ïö¥ Ï¥àÍ∏∞Ìôî
    function initializeDropdown() {
        const select = $('#songSelect');
        
        // Î™®Îì† Í≥°ÏùÑ ÏòµÏÖòÏúºÎ°ú Ï∂îÍ∞Ä
        songs.forEach((song, idx) => {
            select.append(`<option value="${idx}">${song.title}</option>`);
        });

        // Select2 Ï¥àÍ∏∞Ìôî
        select.select2({
            placeholder: "üîç Í≥°ÏùÑ ÏÑ†ÌÉùÌïòÍ±∞ÎÇò Í≤ÄÏÉâÌïòÏÑ∏Ïöî...",
            allowClear: true,
            width: '100%'
        });

        // ÏÑ†ÌÉù Ïù¥Î≤§Ìä∏ Ï≤òÎ¶¨
        select.on('change', function() {
            const selectedIdx = $(this).val();
            if (selectedIdx !== '') {
                // ÏÑ†ÌÉùÎêú Í≥° ÌëúÏãú
                renderSelectedSong(parseInt(selectedIdx));
                
                const resultsDiv = document.getElementById('searchResults');
                resultsDiv.textContent = `ÏÑ†ÌÉùÎêú Í≥°: ${songs[selectedIdx].title}`;
                document.getElementById('noResults').style.display = 'none';
            } else {
                // ÏÑ†ÌÉù Ìï¥Ï†ú Ïãú Î™®Îì† ÏòÅÏÉÅ Ï†úÍ±∞
                clearAllContent();
            }
        });
    }

    // Î™®Îì† Ïª®ÌÖêÏ∏† Ï†úÍ±∞
    function clearAllContent() {
        const area = document.getElementById('songs-area');
        area.innerHTML = '';
        
        // ÌòÑÏû¨ ÌîåÎ†àÏù¥Ïñ¥ Ï†ïÎ¶¨
        if (currentPlayer) {
            try {
                if (currentPlayer.guitar) currentPlayer.guitar.destroy();
                if (currentPlayer.bass) currentPlayer.bass.destroy();
            } catch (error) {
                console.log('ÌîåÎ†àÏù¥Ïñ¥ Ï†ïÎ¶¨ Ï§ë Ïò§Î•ò:', error);
            }
            currentPlayer = null;
        }
        
        // ÌåùÏóÖ Ï†ïÎ¶¨
        Object.keys(currentPopupWindows).forEach(type => {
            const popupData = currentPopupWindows[type];
            if (popupData && popupData.window && !popupData.window.closed) {
                popupData.window.close();
            }
        });
        currentPopupWindows = {};
        
        currentSongIdx = -1;
        
        const resultsDiv = document.getElementById('searchResults');
        resultsDiv.textContent = 'Í≥°ÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî';
        document.getElementById('noResults').style.display = 'none';
    }

    // 4. Ïú†ÌäúÎ∏å API Î°úÎìú
    function loadYouTubeAPI() {
        const tag = document.createElement('script');
        tag.src = 'https://www.youtube.com/iframe_api';
        const firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
    }

    // 5. API Ï§ÄÎπÑ ÏôÑÎ£å ÏΩúÎ∞±
    function onYouTubeIframeAPIReady() {
        // Ï¥àÍ∏∞ÏóêÎäî ÏïÑÎ¨¥Í≤ÉÎèÑ ÌïòÏßÄ ÏïäÏùå (Í≥° ÏÑ†ÌÉù ÏãúÏóêÎßå ÌîåÎ†àÏù¥Ïñ¥ ÏÉùÏÑ±)
    }

    // ÌòÑÏû¨ Í≥° ÌåùÏóÖ ÏúàÎèÑÏö∞ Ïó¥Í∏∞
    function openCurrentPopupWindow(type) {
        if (type !== 'guitar' || currentSongIdx === -1) return;

        const song = songs[currentSongIdx];
        const videoId = song.guitarId;
        const title = 'Í∏∞ÌÉÄ Ïó∞Ï£º';
        const windowName = type + '_current_' + Date.now();

        const popup = window.open('', windowName, 'width=900,height=700,scrollbars=no,resizable=yes');

        if (!popup) {
            alert('ÌåùÏóÖÏù¥ Ï∞®Îã®ÎêòÏóàÏäµÎãàÎã§. Î∏åÎùºÏö∞Ï†ÄÏóêÏÑú ÌåùÏóÖÏùÑ ÌóàÏö©Ìï¥Ï£ºÏÑ∏Ïöî.');
            return;
        }

        // ÌåùÏóÖ HTML ÏûëÏÑ±
        popup.document.open();
        popup.document.write('<!DOCTYPE html>');
        popup.document.write('<html><head><title>' + title + '</title>');
        popup.document.write('<style>');
        popup.document.write('body{margin:0;padding:0;background:black;overflow:hidden;}');
        popup.document.write('#player{width:100vw;height:100vh;}');
        popup.document.write('.controls{position:fixed;top:10px;right:10px;z-index:1000;background:rgba(0,0,0,0.7);padding:10px;border-radius:5px;}');
        popup.document.write('.btn{background:#ff0000;color:white;border:none;padding:8px 12px;margin:2px;border-radius:3px;cursor:pointer;}');
        popup.document.write('.info{position:fixed;top:10px;left:10px;color:white;background:rgba(0,0,0,0.7);padding:10px;border-radius:5px;font-family:Arial;}');
        popup.document.write('.status{position:fixed;bottom:50px;left:10px;color:yellow;background:rgba(0,0,0,0.8);padding:5px;border-radius:3px;font-family:Arial;font-size:12px;}');
        popup.document.write('</style></head><body>');
        popup.document.write('<div class="controls">');
        popup.document.write('<div style="color:white;margin-bottom:5px;">' + title + '</div>');
        popup.document.write('<button class="btn" onclick="toggleFullscreen()">Ï†ÑÏ≤¥ÌôîÎ©¥</button>');
        popup.document.write('<button class="btn" onclick="window.close()">Ï∞Ω Îã´Í∏∞</button>');
        popup.document.write('</div>');
        popup.document.write('<div class="info">F11: Ï†ÑÏ≤¥ÌôîÎ©¥ | ESC: Ìï¥Ï†ú</div>');
        popup.document.write('<div class="status" id="status">Î°úÎî© Ï§ë...</div>');
        popup.document.write('<div id="player"></div>');
        popup.document.write('</body></html>');
        popup.document.close();

        // ÌåùÏóÖÏóê Ïä§ÌÅ¨Î¶ΩÌä∏ Ï∂îÍ∞Ä
        const script1 = popup.document.createElement('script');
        script1.src = 'https://www.youtube.com/iframe_api';
        popup.document.head.appendChild(script1);

        const script2 = popup.document.createElement('script');
        script2.innerHTML = `
            let player;
            let isReady = false;

            function updateStatus(msg) {
                const el = document.getElementById('status');
                if (el) el.textContent = msg;
            }

            window.onYouTubeIframeAPIReady = function() {
                updateStatus('ÌîåÎ†àÏù¥Ïñ¥ ÏÉùÏÑ± Ï§ë...');
                player = new YT.Player('player', {
                    height: '100%',
                    width: '100%',
                    videoId: '${videoId}',
                    playerVars: {
                        'controls': 1,
                        'modestbranding': 1,
                        'rel': 0,
                        'fs': 1,
                        'autoplay': 0
                    },
                    events: {
                        'onReady': function() {
                            isReady = true;
                            updateStatus('ÌîåÎ†àÏù¥Ïñ¥ Ï§ÄÎπÑ ÏôÑÎ£å');
                            if (window.opener) {
                                window.opener.postMessage({
                                    type: 'popupReady',
                                    windowType: '${type}',
                                    songIdx: 'current'
                                }, '*');
                            }
                            setTimeout(() => {
                                const statusEl = document.getElementById('status');
                                if (statusEl) statusEl.style.display = 'none';
                            }, 2000);
                        }
                    }
                });
            };

            function toggleFullscreen() {
                if (!document.fullscreenElement) {
                    document.documentElement.requestFullscreen();
                } else {
                    document.exitFullscreen();
                }
            }

            document.addEventListener('keydown', function(e) {
                if (e.key === 'F11') {
                    e.preventDefault();
                    toggleFullscreen();
                }
            });

            window.addEventListener('message', function(event) {
                if (event.data.type === 'control' && player && isReady) {
                    try {
                        switch(event.data.action) {
                            case 'play':
                                player.playVideo();
                                break;
                            case 'stop':
                                player.stopVideo();
                                break;
                            case 'seekTo':
                                if (event.data.time !== undefined) {
                                    player.seekTo(event.data.time, true);
                                }
                                break;
                        }
                    } catch (error) {
                        console.error('Control error:', error);
                    }
                }
            });
        `;
        popup.document.head.appendChild(script2);

        currentPopupWindows[type] = {
            window: popup,
            ready: false
        };
    }

    // ÌòÑÏû¨ Í≥° ÎèôÏãú Ïû¨ÏÉù
    function playCurrentBoth() {
        if (!currentPlayer || currentSongIdx === -1) return;
        
        try {
            currentPlayer.guitar.playVideo();
            setTimeout(() => {
                currentPlayer.bass.playVideo();
            }, Math.abs(currentOffsetSeconds) * 1000);

            // ÌåùÏóÖÏóêÎèÑ Ïû¨ÏÉù Ïã†Ìò∏
            Object.keys(currentPopupWindows).forEach(type => {
                const popupData = currentPopupWindows[type];
                if (popupData && popupData.window && !popupData.window.closed && popupData.ready) {
                    try {
                        popupData.window.postMessage({ type: 'control', action: 'play' }, '*');
                    } catch (error) {
                        console.error('Message send error:', error);
                    }
                }
            });
        } catch (error) {
            console.log('Ïû¨ÏÉù Ïò§Î•ò:', error);
        }
    }

    // ÌòÑÏû¨ Í≥° Ï†ïÏßÄ
    function stopCurrentBoth() {
        if (!currentPlayer || currentSongIdx === -1) return;
        
        try {
            currentPlayer.guitar.stopVideo();
            currentPlayer.bass.stopVideo();

            // ÌåùÏóÖÏóêÎèÑ Ï†ïÏßÄ Ïã†Ìò∏
            Object.keys(currentPopupWindows).forEach(type => {
                const popupData = currentPopupWindows[type];
                if (popupData && popupData.window && !popupData.window.closed && popupData.ready) {
                    try {
                        popupData.window.postMessage({ type: 'control', action: 'stop' }, '*');
                    } catch (error) {
                        console.error('Message send error:', error);
                    }
                }
            });
        } catch (error) {
            console.log('Ï†ïÏßÄ Ïò§Î•ò:', error);
        }
    }

    // ÌòÑÏû¨ Í≥° Ïã±ÌÅ¨ ÏÑ§Ï†ï
    function setCurrentSyncDelay() {
        if (currentSongIdx === -1) return;
        
        const song = songs[currentSongIdx];
        const slider = document.getElementById('syncSlider');
        const valueDisplay = document.getElementById('syncValue');
        
        // Ïä¨ÎùºÏù¥ÎçîÎ•º ÏõêÎûò Í≥°Ïùò Í∏∞Î≥∏Í∞íÏúºÎ°ú Î¶¨ÏÖã
        if (slider && valueDisplay) {
            slider.value = song.delay;
            valueDisplay.textContent = song.delay + 'Ï¥à';
            currentOffsetSeconds = song.delay;
        } else {
            currentOffsetSeconds = song.delay;
        }
    }

    // ÌòÑÏû¨ Í≥° Î≤ÑÌäº ÌôúÏÑ±Ìôî/ÎπÑÌôúÏÑ±Ìôî
    function enableCurrentButtons(enabled) {
        ['currentGuitarPopupBtn', 'currentPlayBtn', 'currentStopBtn', 'currentSyncBtn'].forEach(id => {
            const btn = document.getElementById(id);
            if (btn) {
                btn.disabled = !enabled;
            }
        });
    }

    // ÌåùÏóÖ Î©îÏãúÏßÄ ÏàòÏã†
    window.addEventListener('message', function(event) {
        if (event.data.type === 'popupReady' && event.data.songIdx === 'current') {
            const type = event.data.windowType;
            if (currentPopupWindows[type]) {
                currentPopupWindows[type].ready = true;
            }
        }
    });

    // ÌéòÏù¥ÏßÄ Ïñ∏Î°úÎìú Ïãú Ï†ïÎ¶¨
    window.addEventListener('beforeunload', () => {
        Object.keys(currentPopupWindows).forEach(type => {
            const popupData = currentPopupWindows[type];
            if (popupData && popupData.window && !popupData.window.closed) {
                popupData.window.close();
            }
        });
    });

    // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Ï¥àÍ∏∞Ìôî
    window.addEventListener('load', () => {
        loadYouTubeAPI();
        initializeDropdown();
    });
    </script>
</body>
</html>
